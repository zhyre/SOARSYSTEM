{% load static %}

<!-- Main Dashboard Sidebar (Tailwind) -->
{% if sidebar_type == 'dashboard' %}
<aside id="sidebar" class="sidebar bg-[#0F172A] text-white w-64 flex-shrink-0 overflow-y-auto">
    <div class="p-6">
        <div class="flex items-center justify-between mb-8">
            <div class="flex items-center space-x-3">
               <img src="{% static 'images/soar-logo.png' %}" alt="SOAR Logo" class="h-10 w-auto">
                <span class="text-xl font-bold"></span>
            </div>
        </div>

        <nav class="space-y-2">
            <a href="{% url 'index' %}" class="flex items-center space-x-3 px-4 py-3 rounded-lg {% if request.resolver_match.url_name == 'index' %}bg-[rgba(61,131,245,0.674)]{% else %}hover:bg-[rgba(61,131,245,0.674)]{% endif %} transition duration-200 ease-in-out">
                <i class="fas fa-home text-lg mt-1.5"></i>
                <span class="font-medium">Home</span>
            </a>
               <a href="{% url 'organizations_page' %}" class="flex items-center space-x-3 px-4 py-3 rounded-lg {% if request.resolver_match.url_name == 'organizations_page' %}bg-[rgba(61,131,245,0.674)]{% else %}hover:bg-[rgba(61,131,245,0.674)]{% endif %} transition duration-200 ease-in-out">
                <i class="fas fa-user text-lg mt-1.5"></i>
                <span class="font-medium">Organization</span>
            </a>
            <a href="{% url 'profile' %}" class="flex items-center space-x-3 px-4 py-3 rounded-lg {% if request.resolver_match.url_name == 'profile' %}bg-[rgba(61,131,245,0.674)]{% else %}hover:bg-[rgba(61,131,245,0.674)]{% endif %} transition duration-200 ease-in-out">
                <i class="fas fa-user text-lg mt-1.5"></i>
                <span class="font-medium">My Profile</span>
            </a>
            <a href="#" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-[rgba(61,131,245,0.674)] transition duration-200 ease-in-out">
                <i class="fas fa-calendar-check text-lg mt-1.5"></i>
                <span class="font-medium">My Events</span>
            </a>
            <a href="#" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-[rgba(61,131,245,0.674)] transition duration-200 ease-in-out">
                <i class="fas fa-bullhorn text-lg mt-1.5"></i>
                <span class="font-medium">Announcements</span>
            </a>
            <a href="#" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-[rgba(61,131,245,0.674)] transition duration-200 ease-in-out">
                <i class="fas fa-cog text-lg mt-1.5"></i>
                <span class="font-medium">Settings</span>
            </a>
        </nav>

        <div class="mt-8 pt-6 border-t border-blue-500">
            <form method="POST" action="{% url 'logout' %}">
                {% csrf_token %}
                <button type="submit" class="w-full flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-[rgba(61,131,245,0.674)] transition duration-200 ease-in-out">
                    <i class="fas fa-sign-out-alt text-lg"></i>
                    <span class="font-medium">Logout</span>
                </button>
            </form>
        </div>
    </div>
</aside>

<!-- Organization Sidebar -->
{% elif sidebar_type == 'organization' %}
<aside id="sidebar" class="sidebar bg-[#0f172a] text-white w-64 flex-shrink-0 overflow-y-auto">
    <div class="p-6">
        <div class="flex items-center justify-between mb-8">
            <div class="flex items-center space-x-3">
                <div class="flex items-center justify-center">
                    <img src="{% static 'images/soar-logo.png' %}" alt="SOAR Logo" class="h-12 w-12">
                </div>
                <span class="logo-text text-xl font-bold text-white"></span>
            </div>
            <button id="sidebarToggle" class="hidden md:block p-2 hover:bg-[rgba(61,131,245,0.674)] rounded-lg transition duration-200 ease-in-out">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <!-- Organization Info -->
        <div class="mb-8 pb-6 border-b border-blue-500">
            <div class="flex items-center space-x-3">
                <div class="w-12 h-12 bg-white rounded-lg flex items-center justify-center">
                    <i class="fas fa-users text-blue-600 text-lg"></i>
                </div>
                <div class="sidebar-text">
                    <h3 class="font-semibold text-sm">{{ organization.name|default:"Organization" }}</h3>
                    <p class="text-blue-200 text-xs">{{ organization.members.count }} member{{ organization.members.count|pluralize }}</p>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="space-y-2">
            <a href="#" class="flex items-center space-x-3 px-4 py-3 rounded-lg {% if request.resolver_match.url_name == 'orgpage' %}bg-[rgba(61,131,245,0.674)]{% else %}hover:bg-[rgba(61,131,245,0.674)]{% endif %} transition duration-200 ease-in-out">
                <i class="fas fa-home text-lg"></i>
                <span class="sidebar-text font-medium">Feed</span>
            </a>
            <a href="#" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-[rgba(61,131,245,0.674)] transition duration-200 ease-in-out">
                <i class="fas fa-calendar-alt text-lg"></i>
                <span class="sidebar-text font-medium">Events</span>
            </a>
            <a href="#" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-[rgba(61,131,245,0.674)] transition duration-200 ease-in-out">
                <i class="fas fa-bullhorn text-lg"></i>
                <span class="sidebar-text font-medium">Announcements</span>
            </a>
            <a href="{% url 'membermanagement' organization.id %}" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-[rgba(61,131,245,0.674)] transition duration-200 ease-in-out">
                <i class="fas fa-user-friends text-lg"></i>
                <span class="sidebar-text font-medium">Members</span>
            </a>
            <a href="{% url 'organization_profile' organization.id  %}" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-[rgba(61,131,245,0.674)] transition duration-200 ease-in-out">
                <i class="fas fa-images text-lg"></i>
                <span class="sidebar-text font-medium">Org Profile</span>
            </a>
            <a href="#" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-[rgba(61,131,245,0.674)] transition duration-200 ease-in-out">
                <i class="fas fa-cog text-lg"></i>
                <span class="sidebar-text font-medium">Settings</span>
            </a>
        </nav>

        <!-- Back to Dashboard -->
        <div class="mt-8 pt-6 border-t border-blue-500">
            <a href="{% url 'index' %}" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-[rgba(61,131,245,0.674)] transition">
                <i class="fas fa-arrow-left text-lg"></i>
                <span class="font-medium">Back to Dashboard</span>
    </div>
</aside>

<!-- Default Sidebar (Legacy) -->
{% else %}
<aside class="sidebar">
    <div class="sidebar-header">
        <img src="{% static 'images/soar-logo.png' %}" alt="SOAR Logo" class="logo">
        <h2></h2>
        <span class="sidebar-close"><i class="fas fa-times"></i></span>
    </div>
    <nav class="sidebar-nav">
        <a href="{% url 'index' %}" class="nav-item {% if request.resolver_match.url_name == 'index' %}active{% endif %}">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
        </a>
        <a href="{% url 'profile' %}" class="nav-item {% if request.resolver_match.url_name == 'profile' %}active{% endif %}">
            <i class="fas fa-user"></i>
            <span>My Profile</span>
        </a>
        <a href="#" class="nav-item">
            <i class="fas fa-calendar-check"></i>
            <span>My Events</span>
        </a>
        <a href="#" class="nav-item">
            <i class="fas fa-bullhorn"></i>
            <span>Announcements</span>
        </a>
        <a href="#" class="nav-item">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
        </a>
    </nav>

    <a href="#" class="nav-item" onclick="document.getElementById('logout-form').submit(); return false;">
        <i class="fas fa-sign-out-alt"></i>
        <span>Logout</span>
    </a>
    <form id="logout-form" method="POST" action="{% url 'logout' %}" style="display: none;">
        {% csrf_token %}
    </form>
</aside>
{% endif %}
<!-- Global Confirm Modal & Toasts -->
<div id="global-confirm-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-40">
    <div class="bg-white rounded-lg shadow-lg max-w-md w-full mx-4 p-6">
        <h3 id="global-confirm-title" class="text-lg font-semibold mb-2">Confirm</h3>
        <p id="global-confirm-message" class="text-sm text-gray-600 mb-4">Are you sure?</p>
        <div class="flex justify-end space-x-2">
            <button id="global-confirm-cancel" class="px-4 py-2 rounded bg-gray-100">Cancel</button>
            <button id="global-confirm-ok" class="px-4 py-2 rounded bg-blue-600 text-white">OK</button>
        </div>
    </div>
</div>

<div id="global-toast-container" style="position: fixed; right: 16px; bottom: 16px; z-index:60; display:flex; flex-direction:column; gap:8px;"></div>

<script>
    // showConfirmModal returns a Promise that resolves true (OK) or false (Cancel)
    function showConfirmModal(title, message) {
        return new Promise((resolve) => {
            const modal = document.getElementById('global-confirm-modal');
            const t = document.getElementById('global-confirm-title');
            const m = document.getElementById('global-confirm-message');
            const ok = document.getElementById('global-confirm-ok');
            const cancel = document.getElementById('global-confirm-cancel');

            t.textContent = title || 'Confirm';
            m.textContent = message || '';

            function cleanup(result) {
                modal.classList.add('hidden');
                ok.removeEventListener('click', onOk);
                cancel.removeEventListener('click', onCancel);
                resolve(result);
            }
            function onOk(e) { e.preventDefault(); cleanup(true); }
            function onCancel(e) { e.preventDefault(); cleanup(false); }

            ok.addEventListener('click', onOk);
            cancel.addEventListener('click', onCancel);

            modal.classList.remove('hidden');
        });
    }

    // showToast(message, type = 'success'|'error'|'info')
    function showToast(message, type='success', duration=3000) {
        const container = document.getElementById('global-toast-container');
        if (!container) return;
        const el = document.createElement('div');
        el.style.minWidth = '200px';
        el.style.padding = '10px 14px';
        el.style.borderRadius = '8px';
        el.style.color = '#fff';
        el.style.boxShadow = '0 4px 14px rgba(0,0,0,0.12)';
        el.style.display = 'flex';
        el.style.alignItems = 'center';
        el.style.gap = '8px';

        if (type === 'success') {
            el.style.background = '#059669';
        } else if (type === 'error') {
            el.style.background = '#dc2626';
        } else {
            el.style.background = '#2563eb';
        }

        el.textContent = message;
        container.appendChild(el);

        setTimeout(() => {
            el.style.transition = 'opacity 0.25s ease, transform 0.25s ease';
            el.style.opacity = '0';
            el.style.transform = 'translateY(6px)';
            setTimeout(() => el.remove(), 300);
        }, duration);
    }
</script>
