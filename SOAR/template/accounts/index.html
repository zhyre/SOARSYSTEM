{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOAR - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/organization/organization_page.css' %}">
    <style>
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .sidebar {
            transition: transform 0.3s ease;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                position: fixed;
                z-index: 50;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }
        }

        /* Animated Gradient Background */
        .content-area {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            position: relative;
        }

        /* Stats Card Enhancements */
        .stat-card {
            position: relative;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.8);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(59, 130, 246, 0.03) 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow:
                0 20px 40px -10px rgba(59, 130, 246, 0.15),
                0 10px 20px -5px rgba(59, 130, 246, 0.1),
                0 0 0 1px rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .stat-card-icon {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .stat-card:hover .stat-card-icon {
            transform: scale(1.15) rotate(5deg);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
        }

        /* Icon Float Animation */
        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .stat-card-icon {
            animation: float 3s ease-in-out infinite;
        }

        .stat-card:nth-child(1) .stat-card-icon {
            animation-delay: 0s;
        }

        .stat-card:nth-child(2) .stat-card-icon {
            animation-delay: 0.5s;
        }

        .stat-card:nth-child(3) .stat-card-icon {
            animation-delay: 1s;
        }

        /* Number Counter */
        .stat-number {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Shimmer Effect */
        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }

            100% {
                background-position: 1000px 0;
            }
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                    transparent,
                    rgba(59, 130, 246, 0.1),
                    transparent);
            transition: left 0.7s;
        }

        .stat-card:hover::after {
            left: 100%;
        }

        /* Organization Card */
        .org-card {
            position: relative;
            background: white;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #e5e7eb;
        }

        .org-card::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            padding: 2px;
            background: linear-gradient(135deg, transparent, rgba(59, 130, 246, 0.5), transparent);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            mask-composite: xor;
            opacity: 0;
            transition: opacity 0.4s;
        }

        .org-card:hover {
            transform: translateY(-6px);
            box-shadow:
                0 20px 35px -10px rgba(59, 130, 246, 0.2),
                0 10px 20px -5px rgba(59, 130, 246, 0.15),
                0 0 0 1px rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .org-card:hover::before {
            opacity: 1;
        }

        /* Fade In Animation */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
        }

        .animate-delay-1 {
            animation-delay: 0.1s;
        }

        .animate-delay-2 {
            animation-delay: 0.2s;
        }

        .animate-delay-3 {
            animation-delay: 0.3s;
        }

        .animate-delay-4 {
            animation-delay: 0.4s;
        }

        .animate-delay-5 {
            animation-delay: 0.5s;
        }

        /* Section Headers */
        .section-header {
            position: relative;
            padding-bottom: 16px;
        }

        .section-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, transparent);
            border-radius: 2px;
        }

        /* See More Button Enhancement */
        .btn-see-more {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .btn-see-more::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-see-more:hover::before {
            width: 300px;
            height: 300px;
        }

        /* Glow Effect */
        @keyframes glow {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            }

            50% {
                box-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
            }
        }

        .stat-card:hover .stat-card-icon {
            animation: glow 2s ease-in-out infinite;
        }

        /* Event Cards */
        .event-card {
            transition: all 0.3s ease;
        }

        .event-card:hover {
            transform: translateX(8px);
            box-shadow:
                0 10px 25px -5px rgba(59, 130, 246, 0.15),
                0 5px 10px -5px rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
        }

        /* No Events State */
        .no-events {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 2px dashed #cbd5e1;
        }

        /* Pulse Animation for Icons */
        @keyframes pulse-ring {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
            }

            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
            }

            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }
        }

        /* Smooth Scroll */
        .overflow-y-auto {
            scroll-behavior: smooth;
        }

        /* Custom Scrollbar */
        .overflow-y-auto::-webkit-scrollbar {
            width: 8px;
        }

        .overflow-y-auto::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .overflow-y-auto::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .overflow-y-auto::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>

<body class="bg-gray-50">
    <!-- Overlay for mobile -->
    <div id="overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden"></div>

    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        {% include 'base/sidebar_components.html' with sidebar_type='dashboard' %}

        <!-- Main Content -->
        <main class="flex-1 flex flex-col overflow-hidden">
            <!-- Top Bar -->
            <header class="bg-white shadow-sm z-10">
                <div class="flex items-center justify-between px-6 py-4">
                    <div class="flex items-center space-x-4">
                        <div>
                            <h1 class="text-2xl font-bold text-gray-800">Welcome, {{ user.first_name|title }} {{ user.last_name|title }}!
                            </h1>
                        </div>
                    </div>
                    <!-- Right Side: Notification Bell + User Profile -->
                    <div class="flex items-center space-x-3">
                        <!-- Notification Bell -->
                        {% include 'base/notification_bell.html' %}

                        <div class="hidden md:block text-right">
                            <p class="text-sm font-medium text-gray-700">{{ user.first_name|title }} {{ user.last_name|title }}</p>

                        </div>
                        <a href="{% url 'profile' %}">
                            {% if user.profile_picture %}
                            <img src="{{ user.profile_picture.url }}" alt="{{ user.last_name }}, {{ user.first_name }}"
                                class="w-10 h-10 rounded-full border-2 border-blue-500 cursor-pointer hover:border-blue-600 transition">
                            {% else %}
                            <img src="https://ui-avatars.com/api/?name={{ user.last_name }}+{{ user.first_name }}&background=2563eb&color=fff"
                                alt="{{ user.last_name }}, {{ user.first_name }}"
                                class="w-10 h-10 rounded-full border-2 border-blue-500 cursor-pointer hover:border-blue-600 transition">
                            {% endif %}
                        </a>
                    </div>
                </div>
            </header>

            <!-- Enhanced Content Area -->
            <div class="flex-1 overflow-y-auto p-6 content-area">
                <!-- Enhanced Stats Cards -->
                <div class="max-w-6xl mx-auto">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                        <!-- Organizations Card -->
                        <div class="stat-card rounded-2xl p-7 cursor-pointer animate-fade-in animate-delay-1">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <p class="text-sm font-semibold text-gray-500 mb-2 uppercase tracking-wider">My
                                        Organizations</p>
                                    <h3 class="text-5xl font-bold stat-number mb-2" data-count="{{ user_orgs.count }}">0
                                    </h3>
                                    <p class="text-xs text-gray-500 font-medium">Active memberships</p>
                                </div>
                                <div
                                    class="stat-card-icon w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg">
                                    <i class="fas fa-users text-white text-2xl"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Events Card -->
                        <div class="stat-card rounded-2xl p-7 cursor-pointer animate-fade-in animate-delay-2">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <p class="text-sm font-semibold text-gray-500 mb-2 uppercase tracking-wider">Upcoming Events</p>
                                    <h3 class="text-5xl font-bold stat-number mb-2" data-count="{{ user_events|length|default_if_none:'0' }}">0</h3>
                                    <p class="text-xs text-gray-500 font-medium">Next 7 days</p>
                                </div>
                                <div
                                    class="stat-card-icon w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center shadow-lg">
                                    <i class="fas fa-calendar-check text-white text-2xl"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Today's Date Card -->
                        <div class="stat-card rounded-2xl p-7 cursor-pointer animate-fade-in animate-delay-3">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <p class="text-sm font-semibold text-gray-500 mb-2 uppercase tracking-wider">
                                        Today's Date</p>
                                    <h3 class="text-4xl font-bold mb-2" id="todayDate">Loading...</h3>
                                    <p class="text-xs text-gray-500 font-medium" id="todayDayOfWeek">Monday</p>
                                </div>
                                <div
                                    class="stat-card-icon w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                                    <i class="fas fa-calendar-alt text-white text-2xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced My Organizations Section -->
                    <div class="mb-12 animate-fade-in animate-delay-4">
                        <div class="flex items-center justify-between mb-8">
                            <div class="section-header">
                                <h2 class="text-3xl font-bold text-gray-800 flex items-center gap-3">
                                    <div
                                        class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-building text-white text-lg"></i>
                                    </div>
                                    My Organizations
                                </h2>
                                <p class="text-gray-600 mt-3 ml-13">Click on an organization to view its dashboard</p>
                            </div>
                            {% if show_see_more %}
                            <a href="{% url 'organizations_page' %}"
                                class="btn-see-more group px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 transition-all flex items-center gap-2 shadow-lg hover:shadow-xl hover:scale-105 relative z-10">
                                <span class="relative z-10">See More</span>
                                <i
                                    class="fas fa-arrow-right group-hover:translate-x-1 transition-transform relative z-10"></i>
                            </a>
                            {% endif %}
                        </div>
                        <div class="animate-fade-in animate-delay-5">
                            {% include 'organization/normal_org_card.html' %}
                        </div>
                    </div>
                </div>

                <!-- Enhanced Upcoming Events Section -->
                <div class="max-w-6xl mx-auto animate-fade-in animate-delay-5">
                    <div class="flex items-center justify-between mb-8">
                        <div class="section-header">
                            <h2 class="text-3xl font-bold text-gray-800 flex items-center gap-3">
                                <div
                                    class="w-10 h-10 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-calendar-alt text-white text-lg"></i>
                                </div>
                                Upcoming Events
                            </h2>
                        </div>
                        {% if not user_events %}
                        <div class="flex items-center gap-2 text-gray-400">
                            <i class="fas fa-info-circle"></i>
                            <span class="text-sm font-medium">No upcoming events</span>
                        </div>
                        {% endif %}
                    </div>
                    <div class="space-y-4">
                        {% for event in user_events %}
                        <div class="event-card">
                            {% include 'event/event_activitycard.html' %}
                        </div>
                        {% empty %}
                        <div class="no-events rounded-2xl p-12 text-center">
                            <div
                                class="w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-calendar-times text-gray-400 text-3xl"></i>
                            </div>
                            <p class="text-gray-500 text-lg font-medium">No upcoming events scheduled</p>
                            <p class="text-gray-400 text-sm mt-2">Check back later for new events</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Event Details Modal (reuse global modal for dashboard) -->
    <div id="eventModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                <!-- Modal Header -->
                <div class="sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between rounded-t-2xl">
                    <h2 class="text-2xl font-bold text-gray-900" id="modalEventTitle">Event Details</h2>
                    <button onclick="closeEventModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                        <svg class="w-6 h-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <!-- Modal Content -->
                <div class="p-6">
                    <!-- Organization Info -->
                    <div class="flex items-center gap-4 mb-6">
                        <div class="flex-shrink-0">
                            <div id="modalOrgLogo" class="w-16 h-16 rounded-xl bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center overflow-hidden flex-shrink-0">
                                <span class="text-white font-bold text-2xl">O</span>
                            </div>
                        </div>
                        <div class="flex-1">
                            <button id="modalOrgLink" class="text-xl font-bold text-blue-600 hover:text-blue-800 transition-colors text-left">
                                Organization Name
                            </button>
                            <p class="text-sm text-gray-500 mt-1">Click to view organization page</p>
                        </div>
                    </div>

                    <!-- Event Image -->
                    <div class="relative h-64 bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 rounded-xl overflow-hidden mb-6">
                        <img id="modalEventImage" src="https://source.unsplash.com/random/800x600/?event,conference,meeting" alt="Event" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent"></div>
                        <div class="absolute top-4 left-4">
                            <span id="modalEventType" class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-white/95 backdrop-blur-sm text-blue-600 rounded-full text-sm font-semibold shadow-lg">Event</span>
                        </div>
                    </div>

                    <!-- Event Description -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-3">About This Event</h3>
                        <p id="modalEventDescription" class="text-gray-700 leading-relaxed">
                            Join us for an exciting event filled with learning and networking opportunities.
                        </p>
                    </div>

                    <!-- Event Details -->
                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <!-- Date & Time -->
                        <div class="flex items-start gap-3">
                            <div class="flex-shrink-0 w-10 h-10 rounded-xl bg-gradient-to-br from-blue-50 to-blue-100 flex items-center justify-center text-blue-600 shadow-sm">
                                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                            </div>
                            <div>
                                <p class="text-sm font-semibold text-gray-900" id="modalEventDate">Friday, January 1, 2024</p>
                                <p class="text-xs text-gray-500 mt-0.5" id="modalEventTime">10:00 AM - 4:00 PM</p>
                            </div>
                        </div>

                        <!-- Location -->
                        <div class="flex items-start gap-3">
                            <div class="flex-shrink-0 w-10 h-10 rounded-xl bg-gradient-to-br from-purple-50 to-purple-100 flex items-center justify-center text-purple-600 shadow-sm">
                                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                            </div>
                            <div>
                                <p class="text-sm font-semibold text-gray-900" id="modalEventLocation">Virtual Event</p>
                                <p class="text-xs text-gray-500 mt-0.5">Click to see map</p>
                            </div>
                        </div>
                    </div>

                    <!-- RSVP Stats -->
                    <div class="flex items-center gap-4 mb-6">
                        <span class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium rounded-lg bg-green-50 text-green-700" id="modalGoingCount">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
                            </svg>
                            0 Going
                        </span>
                        <span class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium rounded-lg bg-amber-50 text-amber-700" id="modalInterestedCount">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                            </svg>
                            0 Interested
                        </span>
                    </div>

                    <!-- RSVP Buttons -->
                    <div id="modalRSVPSection" class="border-t border-gray-200 pt-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Will you attend?</h3>
                        <div class="rsvp-buttons flex justify-between items-center gap-3 w-full" id="modalRSVPButtons">
                            <button onclick="rsvpFromModal('going')" class="rsvp-btn flex-1 px-4 py-3 border border-gray-300 rounded-full hover:bg-green-50 hover:border-green-300 transition-all duration-200 inline-flex items-center justify-center gap-2 font-medium text-gray-700 hover:text-green-600">
                                <i class="fas fa-check-circle"></i>
                                <span>Going</span>
                            </button>
                            <button onclick="rsvpFromModal('interested')" class="rsvp-btn flex-1 px-4 py-3 border border-gray-300 rounded-full hover:bg-yellow-50 hover:border-yellow-300 transition-all duration-200 inline-flex items-center justify-center gap-2 font-medium text-gray-700 hover:text-yellow-600">
                                <i class="fas fa-star"></i>
                                <span>Interested</span>
                            </button>
                            <button onclick="rsvpFromModal('not_going')" class="rsvp-btn flex-1 px-4 py-3 border border-gray-300 rounded-full hover:bg-red-50 hover:border-red-300 transition-all duration-200 inline-flex items-center justify-center gap-2 font-medium text-gray-700 hover:text-red-600">
                                <i class="fas fa-times-circle"></i>
                                <span>Not Going</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mobile menu toggle
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');

        mobileMenuToggle?.addEventListener('click', () => {
            sidebar.classList.toggle('mobile-open');
            overlay.classList.toggle('hidden');
        });

        overlay?.addEventListener('click', () => {
            sidebar.classList.remove('mobile-open');
            overlay.classList.add('hidden');
        });

        // Counter Animation for Stats
        function animateCounter(element) {
            const target = parseInt(element.getAttribute('data-count'));
            const duration = 2000;
            const increment = target / (duration / 16);
            let current = 0;

            const updateCounter = () => {
                current += increment;
                if (current < target) {
                    element.textContent = Math.floor(current);
                    requestAnimationFrame(updateCounter);
                } else {
                    element.textContent = target;
                }
            };

            updateCounter();
        }

        // Trigger counter animation on page load
        document.addEventListener('DOMContentLoaded', () => {
            const counters = document.querySelectorAll('[data-count]');
            counters.forEach(counter => {
                setTimeout(() => animateCounter(counter), 500);
            });

            // Update today's date
            const today = new Date();
            const dateString = today.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
            const dayOfWeek = today.toLocaleDateString('en-US', {
                weekday: 'long'
            });
            
            document.getElementById('todayDate').textContent = dateString;
            document.getElementById('todayDayOfWeek').textContent = dayOfWeek;

            // Add stagger animation to organization cards
            const orgCards = document.querySelectorAll('.org-card');
            orgCards.forEach((card, index) => {
                card.style.animationDelay = `${0.6 + (index * 0.1)}s`;
                card.classList.add('animate-fade-in');
            });

            // Add observer for scroll animations
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-fade-in');
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.event-card').forEach(card => {
                observer.observe(card);
            });
        });

        // --- Event modal logic (dashboard) ---
        const allEvents = JSON.parse('{{ user_events_json|escapejs }}');
        let currentModalEventId = null;

        function openEventModal(eventId) {
            currentModalEventId = eventId;
            const eventData = allEvents.find(ev => ev.id === eventId);
            if (!eventData) return;

            document.getElementById('modalEventTitle').textContent = eventData.title;
            document.getElementById('modalOrgLink').textContent = eventData.organization;
            document.getElementById('modalOrgLink').onclick = () => {
                window.location.href = `/organization/orgpage/${eventData.organization_id}/`;
            };

            const orgLogo = document.getElementById('modalOrgLogo');
            if (eventData.organization_picture) {
                orgLogo.innerHTML = `<img src="${eventData.organization_picture}" alt="${eventData.organization}" class="w-full h-full object-cover rounded-lg">`;
            } else {
                orgLogo.innerHTML = `<span class="text-white font-bold text-2xl">${eventData.organization.charAt(0).toUpperCase()}</span>`;
            }

            document.getElementById('modalEventDescription').textContent = eventData.description || '';
            document.getElementById('modalEventType').textContent = eventData.type ? eventData.type.charAt(0).toUpperCase() + eventData.type.slice(1) : 'Event';

            const eventDate = new Date(eventData.date);
            document.getElementById('modalEventDate').textContent = eventDate.toLocaleDateString('en-US', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            });
            document.getElementById('modalEventTime').textContent = eventDate.toLocaleTimeString('en-US', {
                hour: 'numeric', minute: '2-digit', hour12: true
            });

            document.getElementById('modalEventLocation').textContent = eventData.location || 'TBD';

            document.getElementById('modalGoingCount').innerHTML = `
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
                </svg>
                ${eventData.going_count} Going
            `;
            document.getElementById('modalInterestedCount').innerHTML = `
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                </svg>
                ${eventData.interested_count} Interested
            `;

            updateModalRSVPButtons(eventData.user_rsvp_status);

            document.getElementById('eventModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeEventModal() {
            document.getElementById('eventModal').classList.add('hidden');
            document.body.style.overflow = '';
            currentModalEventId = null;
        }

        function updateModalRSVPButtons(activeStatus) {
            const buttons = ['going', 'interested', 'not_going'];
            for (const status of buttons) {
                const button = document.getElementById('modalRSVPButtons').querySelector(`[onclick="rsvpFromModal('${status}')"]`);
                if (!button) continue;
                button.classList.remove('bg-green-500','border-green-500','bg-yellow-500','border-yellow-500','bg-red-500','border-red-500','text-white','shadow-md');
                button.classList.add('text-gray-700','border-gray-300');
                if (status === activeStatus) {
                    button.classList.remove('text-gray-700','border-gray-300');
                    button.classList.add('text-white','shadow-md');
                    if (status === 'going') button.classList.add('bg-green-500','border-green-500');
                    else if (status === 'interested') button.classList.add('bg-yellow-500','border-yellow-500');
                    else if (status === 'not_going') button.classList.add('bg-red-500','border-red-500');
                }
            }
        }

        function rsvpFromModal(status) {
            if (!currentModalEventId) return;
            const eventData = allEvents.find(ev => ev.id === currentModalEventId);
            if (!eventData) return;

            const formData = new FormData();
            formData.append('status', status);
            formData.append('csrfmiddlewaretoken', document.querySelector('[name=csrfmiddlewaretoken]')?.value || '');

            fetch(`/event/rsvp/${currentModalEventId}/`, {
                method: 'POST',
                body: formData,
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            })
            .then(res => res.json())
            .then(data => {
                if (!data.success) return;
                eventData.user_rsvp_status = status;
                eventData.going_count = data.going_count;
                eventData.interested_count = data.interested_count;
                updateModalRSVPButtons(status);
                document.getElementById('modalGoingCount').innerHTML = `
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
                    </svg>
                    ${data.going_count} Going
                `;
                document.getElementById('modalInterestedCount').innerHTML = `
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                    </svg>
                    ${data.interested_count} Interested
                `;
            })
            .catch(() => {});
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !document.getElementById('eventModal').classList.contains('hidden')) {
                closeEventModal();
            }
        });

        document.getElementById('eventModal')?.addEventListener('click', (e) => {
            if (e.target.id === 'eventModal') closeEventModal();
        });
    </script>
</body>

</html>